

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pipelines &mdash; Selecta 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Selecta
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">selecta</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Selecta</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>pipelines</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pipelines</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Pipeline module.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tarfile</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="k">import</span> <span class="n">copyfile</span>
<span class="kn">from</span> <span class="nn">bsub</span> <span class="k">import</span> <span class="n">bsub</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Nima Pakseresht, Blaise Alako&#39;</span>

<div class="viewcode-block" id="DtuCge"><a class="viewcode-back" href="../pipelines.html#pipelines.DtuCge">[docs]</a><span class="k">class</span> <span class="nc">DtuCge</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	docker run -ti --rm -v /analysis/cbs/databases:/databases -v \</span>
<span class="sd">	/analysis/nima/cge-workspace/workspace:/workdir \</span>
<span class="sd">	cgetools BAP --wdir /workdir --fq1 /workdir/ERR1698597_1.fastq.gz \</span>
<span class="sd">	 --fq2 /workdir/ERR1698597_2.fastq.gz --Asp Illumina --Ast paired</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fq1</span><span class="p">,</span> <span class="n">fq2</span><span class="p">,</span> <span class="n">database_dir</span><span class="p">,</span> <span class="n">workdir</span><span class="p">,</span> <span class="n">sequencing_machine</span><span class="p">,</span>
				 <span class="n">pair</span><span class="p">,</span> <span class="n">run_accession</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">instrument_model</span><span class="p">,</span> <span class="n">sample_accession</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Initialize object variables</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fq1</span> <span class="o">=</span> <span class="n">fq1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fq2</span> <span class="o">=</span> <span class="n">fq2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">run_accession</span> <span class="o">=</span> <span class="n">run_accession</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">=</span> <span class="n">sample_accession</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">database_dir</span> <span class="o">=</span> <span class="n">database_dir</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">workdir</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sequencing_machine</span> <span class="o">=</span> <span class="n">sequencing_machine</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pair</span> <span class="o">=</span> <span class="n">pair</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">instrument_model</span> <span class="o">=</span> <span class="n">instrument_model</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lsf</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">lsf</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cgetools</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">cgetools</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rmem</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">rmem</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lmem</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">lmem</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bgroup</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">bgroup</span>

		<span class="n">error_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span> <span class="o">=</span> <span class="n">error_list</span>

<div class="viewcode-block" id="DtuCge.command_builder_mock"><a class="viewcode-back" href="../pipelines.html#pipelines.DtuCge.command_builder_mock">[docs]</a>	<span class="k">def</span> <span class="nf">command_builder_mock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Mock command builder for quick prototyping</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">bap</span> <span class="o">=</span> <span class="s2">&quot;/usr/src/cgepipeline/cgetools/BAP.py&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pair</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
			<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;mkdir -p </span><span class="si">{}</span><span class="s2">  &amp;&amp; du -hs /homes/blaise/bin </span><span class="se">\</span>
<span class="s2">			 &amp;&amp;  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>

			<span class="n">command</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot; cp -fv /homes/blaise/conda.list </span><span class="si">{}</span><span class="s2">out.tsv ; mkdir -p </span><span class="si">{}{}</span><span class="s2">; mkdir -p  </span><span class="si">{}{}</span><span class="s2">; </span><span class="se">\</span>
<span class="s2">			mkdir -p </span><span class="si">{}{}</span><span class="s2">; mkdir -p </span><span class="si">{}{}</span><span class="s2">; mkdir -p </span><span class="si">{}{}</span><span class="s2">; mkdir -p </span><span class="si">{}{}</span><span class="s2">; mkdir -p </span><span class="si">{}{}</span><span class="s2"> ; mkdir -p </span><span class="si">{}{}</span><span class="s2">;  </span><span class="se">\</span>
<span class="s2">			cp -fv /homes/blaise/conda.list </span><span class="si">{}{}</span><span class="s2">/results.txt ;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;Assembler&#39;</span><span class="p">,</span>
																	   <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;ContigAnalyzer&#39;</span><span class="p">,</span>
																	   <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;KmerFinder&#39;</span><span class="p">,</span>
																	   <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;PlasmidFinder&#39;</span><span class="p">,</span>
																	   <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;ResFinder&#39;</span><span class="p">,</span>
																	   <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;VirulenceFinder&#39;</span><span class="p">,</span>
																	   <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;MLST&#39;</span><span class="p">,</span>
																	   <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;cgMLSTFinder&#39;</span><span class="p">,</span>
																	   <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;cgMLSTFinder&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
			<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;singularity exec -B </span><span class="si">{}</span><span class="s2">:/databases -B </span><span class="si">{}</span><span class="s2">:/workdir </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">			--wdir /workdir --fq1 /workdir/</span><span class="si">{}</span><span class="s2"> --Asp </span><span class="si">{}</span><span class="s2"> --Ast paired&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_dir</span><span class="p">,</span>
																			<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
																			<span class="bp">self</span><span class="o">.</span><span class="n">cgetools</span><span class="p">,</span>
																			<span class="n">bap</span><span class="p">,</span>
																			<span class="bp">self</span><span class="o">.</span><span class="n">fq1</span><span class="p">,</span>
																			<span class="bp">self</span><span class="o">.</span><span class="n">sequencing_machine</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">command</span></div>

<div class="viewcode-block" id="DtuCge.command_builder"><a class="viewcode-back" href="../pipelines.html#pipelines.DtuCge.command_builder">[docs]</a>	<span class="k">def</span> <span class="nf">command_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Command builder for tool in question</span>
<span class="sd">		:return: a mock command for the purpose of quick testing</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
		<span class="n">bap</span> <span class="o">=</span> <span class="s2">&quot;/usr/src/cgepipeline/cgetools/BAP.py&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pair</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
			<span class="sd">&quot;&quot;&quot; Use singularity instead to run cgetools&quot;&quot;&quot;</span>

			<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;singularity exec -B </span><span class="si">{}</span><span class="s2">:/databases -B </span><span class="si">{}</span><span class="s2">:/workdir </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">			--wdir /workdir --fq1 /workdir/</span><span class="si">{}</span><span class="s2"> --fq2 /workdir/</span><span class="si">{}</span><span class="s2"> --Asp </span><span class="si">{}</span><span class="s2"> --Ast paired&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_dir</span><span class="p">,</span>
																							  <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
																							  <span class="bp">self</span><span class="o">.</span><span class="n">cgetools</span><span class="p">,</span>
																							  <span class="n">bap</span><span class="p">,</span>
																							  <span class="bp">self</span><span class="o">.</span><span class="n">fq1</span><span class="p">,</span>
																							  <span class="bp">self</span><span class="o">.</span><span class="n">fq2</span><span class="p">,</span>
																							  <span class="bp">self</span><span class="o">.</span><span class="n">sequencing_machine</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;singularity exec -B </span><span class="si">{}</span><span class="s2">:/databases -B </span><span class="si">{}</span><span class="s2">:/workdir </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">			--wdir /workdir --fq1 /workdir/</span><span class="si">{}</span><span class="s2"> --Asp &#39;</span><span class="si">{}</span><span class="s2">&#39; --Ast single&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_dir</span><span class="p">,</span>
																			  <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
																			  <span class="bp">self</span><span class="o">.</span><span class="n">cgetools</span><span class="p">,</span>
																			  <span class="n">bap</span><span class="p">,</span>
																			  <span class="bp">self</span><span class="o">.</span><span class="n">fq1</span><span class="p">,</span>
																			  <span class="bp">self</span><span class="o">.</span><span class="n">sequencing_machine</span><span class="p">)</span> <span class="c1"># Make use of the instrument model define above</span>
		<span class="k">return</span> <span class="n">command</span></div>

<div class="viewcode-block" id="DtuCge.run"><a class="viewcode-back" href="../pipelines.html#pipelines.DtuCge.run">[docs]</a>	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		run the command constructed by the command builder method</span>
<span class="sd">		:param command: compare pipeline-tool name to call</span>
<span class="sd">		:return: job id if LSF used otherwise none</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;running the command&quot;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cgetools</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="n">job_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="n">processing_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsf</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NO LSF MODE: </span><span class="se">\n</span><span class="s2"> Running Command: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
			<span class="n">sub_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
			<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">sub_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">out</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;standard output of subprocess:&quot;</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
					<span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
						<span class="n">message</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
					<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="k">if</span> <span class="n">err</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;standard error of subprocess:&quot;</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR MESSAGE: </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
				<span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

				<span class="n">data</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
					<span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
						<span class="n">message</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
					<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="k">if</span> <span class="n">sub_process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsf</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LSF option is true... PAIRED_END</span><span class="si">{}</span><span class="s2"> , type_of:</span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pair</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pair</span><span class="p">)))</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pair</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
				<span class="n">job_id</span> <span class="o">=</span> <span class="n">bsub</span><span class="p">(</span><span class="s1">&#39;core_executor_&#39;</span> <span class="o">+</span> <span class="n">processing_id</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rmem</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmem</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bgroup</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">command</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PAIRED-END:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pair</span><span class="p">))</span>
				<span class="n">job_id</span> <span class="o">=</span> <span class="n">bsub</span><span class="p">(</span><span class="s1">&#39;core_executor_&#39;</span> <span class="o">+</span> <span class="n">processing_id</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="s1">&#39;singularity&#39;</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rmem</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmem</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bgroup</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">command</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">job_id</span><span class="p">]</span></div>


<div class="viewcode-block" id="DtuCge.copy_src_into_dest"><a class="viewcode-back" href="../pipelines.html#pipelines.DtuCge.copy_src_into_dest">[docs]</a>	<span class="k">def</span> <span class="nf">copy_src_into_dest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		copy pipeline intermediate files into a destination directory for the</span>
<span class="sd">		purpose of archiving.</span>
<span class="sd">		:param src:  Source directory</span>
<span class="sd">		:param dest: Destination directory</span>
<span class="sd">		:return: None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
		<span class="n">dest_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Copying </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest_file</span><span class="p">))</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest_file</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">shutil</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
			<span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Directory not copied. Error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
			<span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Directory not copied. Error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="DtuCge.delete_empty_files"><a class="viewcode-back" href="../pipelines.html#pipelines.DtuCge.delete_empty_files">[docs]</a>	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">delete_empty_files</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Delete empty files from a directory</span>
<span class="sd">		:param folder: directory containing empty files</span>
<span class="sd">		:return: None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deleting Empty files in folder: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">folder</span><span class="p">))</span>
		<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
				<span class="n">fullname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

				<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;To be deleted files:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
					<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span></div>

<div class="viewcode-block" id="DtuCge.make_tar_gzip"><a class="viewcode-back" href="../pipelines.html#pipelines.DtuCge.make_tar_gzip">[docs]</a>	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">make_tar_gzip</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">des</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Create and archive and compressed it</span>
<span class="sd">		:param src: directory to be archived</span>
<span class="sd">		:param des: name of the archive and compressed directory</span>
<span class="sd">		:return: None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">src</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.tar.gz&#39;</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Archiving and compressing:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
		<span class="n">des</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">des</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
		<span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">des</span><span class="p">,</span> <span class="s2">&quot;w:gz&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
			<span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">src</span><span class="p">))</span></div>

<div class="viewcode-block" id="DtuCge.zip_dir"><a class="viewcode-back" href="../pipelines.html#pipelines.DtuCge.zip_dir">[docs]</a>	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">zip_dir</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Compress a directory with zip tool</span>
<span class="sd">		:param src: directory to compress</span>
<span class="sd">		:return:  None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">src</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.zip&#39;</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ziping </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
		<span class="n">zfile</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">subdirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">subdirs</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
			<span class="n">zfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
				<span class="n">zfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
		<span class="n">zfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="DtuCge.del_file"><a class="viewcode-back" href="../pipelines.html#pipelines.DtuCge.del_file">[docs]</a>	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">del_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Delete a single file name</span>
<span class="sd">		:param filename: file name to delete</span>
<span class="sd">		:return:  None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Deleting: </span><span class="si">{}</span><span class="s1"> exists and is been deleted....&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
			<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

		<span class="c1"># def change_permission(filename):</span>


<div class="viewcode-block" id="DtuCge.post_process"><a class="viewcode-back" href="../pipelines.html#pipelines.DtuCge.post_process">[docs]</a>	<span class="k">def</span> <span class="nf">post_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Postprocess analysis result of a pipeline.</span>
<span class="sd">		We should account for multiplexing in fastqs. We should add the name of the sample in the final file summary and chuncks that will be</span>
<span class="sd">		submitted to the FTP server. This is from the the observation that the same samples from the same processed runs will have similar name</span>
<span class="sd">		however their checksum values is different.</span>
<span class="sd">		Examples:</span>
<span class="sd">		dcc_allison PRJEB2059 ERR023804 (12)--</span>
<span class="sd">		dcc_allison PRJEB2059 &#39;ERR028305&#39;,&#39;ERR028650&#39;</span>
<span class="sd">		:return: compressed archived folder of pipeline runs and summary file(s)</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Doing post process:.........&quot;</span><span class="p">)</span>
		<span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;chmod -R a+rw </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="n">sub_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
		<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">sub_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">out</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">err</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>

		<span class="n">DtuCge</span><span class="o">.</span><span class="n">delete_empty_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="c1"># use process_id (new_run_process ) instead of run_id (self.run_accession) to account for problematic duplicate RUNS ids from different datahub</span>
		<span class="n">new_run_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">all_result_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_DTU_CGE_all&quot;</span>

		<span class="n">DtuCge</span><span class="o">.</span><span class="n">del_file</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">all_result_name_gzip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_DTU_CGE_all.tar.gz&quot;</span>
		<span class="n">DtuCge</span><span class="o">.</span><span class="n">del_file</span><span class="p">(</span><span class="n">all_result_name_gzip</span><span class="p">)</span>
		<span class="n">tab_result_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_DTU_CGE_summary.tsv&quot;</span>
		<span class="n">DtuCge</span><span class="o">.</span><span class="n">del_file</span><span class="p">(</span><span class="n">tab_result_name</span><span class="p">)</span>
		<span class="sd">&quot;&quot;&quot; Handle the cgMLTSFinder resutl.txt tab file ...&quot;&quot;&quot;</span>
		<span class="n">tab_result_name2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_cgMLSTFinder_analysis_DTU_CGE_results.tsv&quot;</span>
		<span class="n">DtuCge</span><span class="o">.</span><span class="n">del_file</span><span class="p">(</span><span class="n">tab_result_name2</span><span class="p">)</span>

		<span class="n">src_tsv_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;out.tsv&#39;</span>
		<span class="n">cgmlstfinder_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;cgMLSTFinder/results.txt&#39;</span>
		<span class="n">src_tsv_file2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cgmlstfinder_result</span><span class="p">):</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cgMLSTFinder results:&quot;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">cgmlstfinder_result</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
			<span class="n">src_tsv_file2</span> <span class="o">=</span> <span class="n">cgmlstfinder_result</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">):</span>
			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">assembler_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;Assembler&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">assembler_dir</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">assembler_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">contiganalyzer_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;ContigAnalyzer&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">contiganalyzer_dir</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">contiganalyzer_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">kmerfinder_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;KmerFinder&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">kmerfinder_dir</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">kmerfinder_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">plasmidfinder_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;PlasmidFinder&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">plasmidfinder_dir</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">plasmidfinder_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">resfinder_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;ResFinder&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">resfinder_dir</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">resfinder_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">virulencefinder_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;VirulenceFinder&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">virulencefinder_dir</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">virulencefinder_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">mlst_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;MLST&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mlst_dir</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">mlst_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">cgmlstfinder_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;cgMLSTFinder&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cgmlstfinder_dir</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">cgmlstfinder_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">salmonellatypefinder_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;SalmonellaTypeFinder&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">salmonellatypefinder_dir</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">salmonellatypefinder_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">DtuCge</span><span class="o">.</span><span class="n">make_tar_gzip</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
			<span class="n">copyfile</span><span class="p">(</span><span class="n">src_tsv_file</span><span class="p">,</span> <span class="n">tab_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">src_tsv_file2</span><span class="p">):</span>
				<span class="n">copyfile</span><span class="p">(</span><span class="n">src_tsv_file2</span><span class="p">,</span> <span class="n">tab_result_name2</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not make tar gzip archive, or copy src tsv to tab_result_name&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Post-process finished for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">))</span>
		<span class="n">tab_result_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_result_name</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tab_result_name2</span><span class="p">):</span>
			<span class="n">tab_result_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tab_result_name2</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">tab_result_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">all_result_name_gzip</span><span class="p">,</span> <span class="n">tab_result_names</span></div>

<div class="viewcode-block" id="DtuCge.execute"><a class="viewcode-back" href="../pipelines.html#pipelines.DtuCge.execute">[docs]</a>	<span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Execute pipeline calling on command_builder and run methods</span>
<span class="sd">		defined in the same class</span>
<span class="sd">		:return: jobs ids or None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_builder</span><span class="p">()</span>
		<span class="c1">#command = self.command_builder_mock()</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DTU command:&#39;</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		<span class="n">jobids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

		<span class="sd">&quot;&quot;&quot; Making use of LSF &quot;&quot;&quot;</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DTU bjobs ids:</span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobids</span><span class="p">))</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">jobids</span></div></div>


<div class="viewcode-block" id="EmcSlim"><a class="viewcode-back" href="../pipelines.html#pipelines.EmcSlim">[docs]</a><span class="k">class</span> <span class="nc">EmcSlim</span><span class="p">:</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This class handle the EMC_SLIM pipeline parameter, execution and postprocessing.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fq1</span><span class="p">,</span> <span class="n">fq2</span><span class="p">,</span> <span class="n">emc_slim_property_file</span><span class="p">,</span> <span class="n">workdir</span><span class="p">,</span> <span class="n">sequencing_machine</span><span class="p">,</span> <span class="n">pair</span><span class="p">,</span> <span class="n">run_accession</span><span class="p">,</span>
				 <span class="n">emc_slim_program</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">instrument_model</span><span class="p">,</span> <span class="n">sample_accession</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Initialise object attributes</span>
<span class="sd">		:param fq1: fastq forward reads</span>
<span class="sd">		:param fq2: fastq reverse reads</span>
<span class="sd">		:param emc_slim_property_file: EMC_SLIM configuration files</span>
<span class="sd">		:param workdir: EMC_SLIME working directory</span>
<span class="sd">		:param sequencing_machine: Sequencing machine platform</span>
<span class="sd">		:param pair: boolean (true or false)</span>
<span class="sd">		:param run_accession: ERR/SRR fastq identifier</span>
<span class="sd">		:param emc_slim_program: absolute path to EMC_SLIM pipeline program</span>
<span class="sd">		:param prop: SELECTA property file</span>
<span class="sd">		:param instrument_model: sequencing machine instrument model</span>
<span class="sd">		:param sample_accession: run biosample_id</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fq1</span> <span class="o">=</span> <span class="n">fq1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fq2</span> <span class="o">=</span> <span class="n">fq2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">emc_slim_program</span> <span class="o">=</span> <span class="n">emc_slim_program</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">emc_slim_property_file</span> <span class="o">=</span> <span class="n">emc_slim_property_file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">run_accession</span> <span class="o">=</span> <span class="n">run_accession</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">=</span> <span class="n">sample_accession</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">workdir</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sequencing_machine</span> <span class="o">=</span> <span class="n">sequencing_machine</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">instrument_model</span> <span class="o">=</span> <span class="n">instrument_model</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pair</span> <span class="o">=</span> <span class="n">pair</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lsf</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">lsf</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rmem</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">rmem</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lmem</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">lmem</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bgroup</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">bgroup</span>
		<span class="n">error_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span> <span class="o">=</span> <span class="n">error_list</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span>
			<span class="s2">&quot;slim.FASTQ1: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">slim.FASTQ2: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">slim.property_file: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">slim.workdir: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">slim.sequence_machine: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">slim.pair: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">slim.run_accession: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">slim.lsf: </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">slim.program: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">slim.rmem: </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">slim.lmem: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">fq1</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">fq2</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">emc_slim_property_file</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">sequencing_machine</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">pair</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">run_accession</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">lsf</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">emc_slim_program</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">rmem</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">lmem</span>
			<span class="p">))</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>


<div class="viewcode-block" id="EmcSlim.command_builder_mock"><a class="viewcode-back" href="../pipelines.html#pipelines.EmcSlim.command_builder_mock">[docs]</a>	<span class="k">def</span> <span class="nf">command_builder_mock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Mock command builder for fast prototyping.</span>
<span class="sd">		:return:  mock command</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pair</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
			<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;mkdir -p </span><span class="si">{}</span><span class="s2"> ; &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
			<span class="n">command</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot;cp -fv /homes/blaise/conda.list </span><span class="si">{}{}</span><span class="s2">_analysis_EMC_SLIM_summary.tsv  ; cp -fv /homes/blaise/conda.2cp.gz </span><span class="si">{}{}</span><span class="s2">_analysis_EMC_SLIM_all.tar.gz ; cp -fv /homes/blaise/conda.list </span><span class="si">{}</span><span class="s2">out.tsv ; mkdir -p </span><span class="si">{}{}</span><span class="s2">; mkdir -p  </span><span class="si">{}{}</span><span class="s2">; mkdir -p </span><span class="si">{}{}</span><span class="s2">; mkdir -p </span><span class="si">{}{}</span><span class="s2">; mkdir -p </span><span class="si">{}{}</span><span class="s2">; mkdir -p </span><span class="si">{}{}</span><span class="s2">; mkdir -p </span><span class="si">{}{}</span><span class="s2">  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_accession</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_accession</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;Assembler&#39;</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;ContigAnalyzer&#39;</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;KmerFinder&#39;</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;PlasmidFinder&#39;</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;ResFinder&#39;</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;VirulenceFinder&#39;</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;MLST&#39;</span><span class="p">)</span>

		<span class="k">else</span><span class="p">:</span>
			<span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;ERROR:Currently cannot deal with non paired fastq files in dtu_sge object&quot;</span>
			<span class="c1"># print &quot;Currently cannot deal with non paired fastq files in dtu_sge object&quot;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">command</span></div>


<div class="viewcode-block" id="EmcSlim.command_builder"><a class="viewcode-back" href="../pipelines.html#pipelines.EmcSlim.command_builder">[docs]</a>	<span class="k">def</span> <span class="nf">command_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Command builder</span>
<span class="sd">		:return: command to run</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">new_run_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pair</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
			<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;python2 -s </span><span class="si">{}</span><span class="s2"> -fq1 </span><span class="si">{}</span><span class="s2"> -fq2 </span><span class="si">{}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">			 -name </span><span class="si">{}</span><span class="s2"> -p </span><span class="si">{}</span><span class="s2"> -wkdir </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emc_slim_program</span><span class="p">,</span>
											  <span class="bp">self</span><span class="o">.</span><span class="n">fq1</span><span class="p">,</span>
											  <span class="bp">self</span><span class="o">.</span><span class="n">fq2</span><span class="p">,</span>
											  <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span><span class="p">,</span>
											  <span class="bp">self</span><span class="o">.</span><span class="n">emc_slim_property_file</span><span class="p">,</span>
											  <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;python2 -s </span><span class="si">{}</span><span class="s2"> -fq1 </span><span class="si">{}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">			-name </span><span class="si">{}</span><span class="s2"> -p </span><span class="si">{}</span><span class="s2"> -wkdir </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emc_slim_program</span><span class="p">,</span>
											 <span class="bp">self</span><span class="o">.</span><span class="n">fq1</span><span class="p">,</span>
											 <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span><span class="p">,</span>
											 <span class="bp">self</span><span class="o">.</span><span class="n">emc_slim_property_file</span><span class="p">,</span>
											 <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">command</span></div>

<div class="viewcode-block" id="EmcSlim.run"><a class="viewcode-back" href="../pipelines.html#pipelines.EmcSlim.run">[docs]</a>	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		run the command constructed by the command builder method</span>
<span class="sd">		:param command: compare pipeline-tool name to call</span>
<span class="sd">		:return: job id if LSF used otherwise none</span>
<span class="sd">	   &quot;&quot;&quot;</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IN RUN FUNCTION: running the command:&quot;</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Requested memory: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmem</span><span class="p">))</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Memory limits: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmem</span><span class="p">))</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="n">processing_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">job_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsf</span><span class="p">:</span>
			<span class="n">sub_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
			<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">sub_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

			<span class="k">if</span> <span class="n">out</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;standard output of subprocess:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
					<span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
						<span class="n">message</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
					<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

			<span class="k">if</span> <span class="n">err</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;standard error of subprocess:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
					<span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
						<span class="n">message</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
					<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="c1">#Comment this out after amending A above</span>
			<span class="k">if</span> <span class="n">sub_process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">err</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
					<span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LSF option is set to true .....&quot;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
			<span class="n">job_id</span> <span class="o">=</span> <span class="n">bsub</span><span class="p">(</span><span class="s1">&#39;core_executor_&#39;</span> <span class="o">+</span> <span class="n">processing_id</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rmem</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmem</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bgroup</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">command</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">job_id</span><span class="p">]</span></div>

		<span class="c1">#</span>
<div class="viewcode-block" id="EmcSlim.post_process"><a class="viewcode-back" href="../pipelines.html#pipelines.EmcSlim.post_process">[docs]</a>	<span class="k">def</span> <span class="nf">post_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Postprocess analysis result of a pipeline.</span>
<span class="sd">		We should account for multiplexing in fastqs. We should add the name of the sample in the final file summary and chuncks that will be</span>
<span class="sd">		submitted to the FTP server. This is from the the observation that the same samples from the same processed runs will have similar name</span>
<span class="sd">		however their checksum values is different.</span>
<span class="sd">		Examples:</span>
<span class="sd">		dcc_allison PRJEB2059 ERR023804 (12)--</span>
<span class="sd">		dcc_allison PRJEB2059 &#39;ERR028305&#39;,&#39;ERR028650&#39;</span>
<span class="sd">		:return: compressed archived folder of pipeline runs and summary file(s)</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">new_run_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">gzip_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_EMC_SLIM_all.tar.gz&quot;</span>
		<span class="n">tab_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_EMC_SLIM_summary.tsv&quot;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">gzip_file</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">gzip_file</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;ERROR: gzip file </span><span class="si">{}</span><span class="s2"> is empty&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gzip_file</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
				<span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;ERROR: gzip file </span><span class="si">{}</span><span class="s2"> doesn&#39;t exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gzip_file</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tab_file</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">tab_file</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;ERROR: tab file </span><span class="si">{}</span><span class="s2"> is empty&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tab_file</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
				<span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

		<span class="k">else</span><span class="p">:</span>
			<span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;ERROR: tab file </span><span class="si">{}</span><span class="s2"> doesn&#39;t exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tab_file</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="n">tab_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_file</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">gzip_file</span><span class="p">,</span> <span class="n">tab_files</span></div>

<div class="viewcode-block" id="EmcSlim.execute"><a class="viewcode-back" href="../pipelines.html#pipelines.EmcSlim.execute">[docs]</a>	<span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Execute pipeline calling on command_builder and run methods</span>
<span class="sd">		defined in the same class</span>
<span class="sd">		:return: jobs ids or None</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_builder</span><span class="p">()</span>
		<span class="c1">#command = self.command_builder_mock()</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;COMMAND:&#39;</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
		<span class="n">jobids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="n">jobids</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">jobids</span></div></div>

<div class="viewcode-block" id="UAntwerpBacpipe"><a class="viewcode-back" href="../pipelines.html#pipelines.UAntwerpBacpipe">[docs]</a><span class="k">class</span> <span class="nc">UAntwerpBacpipe</span><span class="p">:</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This class handle the UAntwerp_Bacpipe pipeline parameter, execution and postprocessing.</span>
<span class="sd">	&quot;&quot;&quot;</span>
<div class="viewcode-block" id="UAntwerpBacpipe.make_tar_gzip"><a class="viewcode-back" href="../pipelines.html#pipelines.UAntwerpBacpipe.make_tar_gzip">[docs]</a>	<span class="k">def</span> <span class="nf">make_tar_gzip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">des</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Create and archive and compressed it</span>
<span class="sd">		:param src: directory to be archived</span>
<span class="sd">		:param des: name of the archive and compressed directory</span>
<span class="sd">		:return: None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SRC DIR:</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s2">Destination:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">src</span> <span class="o">+</span> <span class="s1">&#39;.tar.gz&#39;</span><span class="p">))</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">src</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.tar.gz&#39;</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Archiving and compressing:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
		<span class="n">des</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">des</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
		<span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">des</span><span class="p">,</span> <span class="s2">&quot;w:gz&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
			<span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">src</span><span class="p">))</span></div>

<div class="viewcode-block" id="UAntwerpBacpipe.copy_src_into_dest"><a class="viewcode-back" href="../pipelines.html#pipelines.UAntwerpBacpipe.copy_src_into_dest">[docs]</a>	<span class="k">def</span> <span class="nf">copy_src_into_dest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		copy pipeline intermediate files into a destination directory for the</span>
<span class="sd">		purpose of archiving.</span>
<span class="sd">		:param src:  Source directory</span>
<span class="sd">		:param dest: Destination directory</span>
<span class="sd">		:return: None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
		<span class="n">dest_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Copying </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest_file</span><span class="p">))</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest_file</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">shutil</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
			<span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Directory not copied. Error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
			<span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Directory not copied. Error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

	<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">&#39;directories&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;reads&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
			<span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
		<span class="p">},</span>
		<span class="s1">&#39;trim_galore&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;deactivate&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span>
			<span class="s1">&#39;reads_type&#39;</span><span class="p">:</span> <span class="s1">&#39;paired&#39;</span><span class="p">,</span>
			<span class="s1">&#39;quality_threshold&#39;</span><span class="p">:</span> <span class="mi">25</span>
		<span class="p">},</span>
		<span class="s1">&#39;spades&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;deactivate&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span>
			<span class="s1">&#39;Mode&#39;</span><span class="p">:</span> <span class="s1">&#39;paired&#39;</span><span class="p">,</span>
			<span class="s1">&#39;kmer&#39;</span><span class="p">:</span> <span class="mi">77</span>
		<span class="p">},</span>
		<span class="s1">&#39;mlst_typing&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;deactivate&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span>
			<span class="s1">&#39;organism&#39;</span><span class="p">:</span> <span class="s1">&#39;lsalivarius&#39;</span>
		<span class="p">},</span>
		<span class="s1">&#39;plasmids_finder&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;deactivate&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span>
			<span class="s1">&#39;plasmids_database&#39;</span><span class="p">:</span> <span class="s1">&#39;gram_positive&#39;</span><span class="p">,</span>
			<span class="s1">&#39;identity_threshold&#39;</span><span class="p">:</span> <span class="mi">95</span>
		<span class="p">},</span>
		<span class="s1">&#39;resfinder&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;deactivate&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span>
			<span class="s1">&#39;identity_threshold&#39;</span><span class="p">:</span> <span class="mi">95</span><span class="p">,</span>
			<span class="s1">&#39;resistance_database&#39;</span><span class="p">:</span> <span class="s1">&#39;aminoglycoside,beta-lactamase,colistin,fosfomycin,fusidicacid,macrolide,nitroimidazole,oxazolidinone,phenicol,quinolone,rifampicin,sulphonamide,tetracycline,trimethoprim,glycopeptide&#39;</span><span class="p">,</span>
			<span class="s1">&#39;min_length&#39;</span><span class="p">:</span> <span class="mf">0.6</span>
		<span class="p">},</span>
		<span class="s1">&#39;cardSearch&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;deactivate&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
		<span class="p">},</span>
		<span class="s1">&#39;emmTyping&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;deactivate&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
		<span class="p">},</span>
		<span class="s1">&#39;virulencefinder&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;deactivate&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span>
			<span class="s1">&#39;identity_threshold&#39;</span><span class="p">:</span> <span class="mi">95</span><span class="p">,</span>
			<span class="s1">&#39;virulence_database&#39;</span><span class="p">:</span> <span class="s1">&#39;virulence_ecoli&#39;</span>
		<span class="p">},</span>
		<span class="s1">&#39;parSNP&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;deactivate&#39;</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span>
			<span class="s1">&#39;parSNP_reference&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
			<span class="s1">&#39;parSNP_reference_fsa&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
		<span class="p">},</span>
		<span class="s1">&#39;VirDBSearch&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;deactivate&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
		<span class="p">},</span>
		<span class="s1">&#39;prokka&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;deactivate&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span>
			<span class="s1">&#39;prokka_path&#39;</span><span class="p">:</span> <span class="s1">&#39;/hps/nobackup/nucleotide/blaise/selecta/python/anaconda2/bin/prokka&#39;</span>
		<span class="p">},</span>
		<span class="s1">&#39;Output&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;deactivate&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
		<span class="p">},</span>
		<span class="s1">&#39;Resfams&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;deactivate&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
		<span class="p">},</span>
		<span class="s1">&#39;bacpipe&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;bacpipe_path&#39;</span><span class="p">:</span> <span class="s1">&#39;/hps/nobackup/nucleotide/blaise/selecta/tools/bacpipe&#39;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">workdir</span><span class="p">,</span> <span class="n">yamlconfig</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">sample_accession</span><span class="p">,</span> <span class="n">pair</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">		:workdir</span>
<span class="sd">		:yamlconfig</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">workdir</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">yamlconfig</span> <span class="o">=</span> <span class="n">yamlconfig</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bacpipe</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">uantwerp_bacpipe_program</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">processor_</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">nproc</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lsf</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">lsf</span>
		<span class="k">if</span> <span class="n">pair</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pair</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pair</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">=</span> <span class="n">sample_accession</span>
		<span class="n">error_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span> <span class="o">=</span> <span class="n">error_list</span>
		<span class="c1"># Added from here missing params</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rmem</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">rmem</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lmem</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">lmem</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bgroup</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">bgroup</span>

<div class="viewcode-block" id="UAntwerpBacpipe.command_builder"><a class="viewcode-back" href="../pipelines.html#pipelines.UAntwerpBacpipe.command_builder">[docs]</a>	<span class="k">def</span> <span class="nf">command_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		pass</span>
<span class="sd">		:return: python ./Pipeline_blaise.py --config configure.yaml --os unix --processors 20</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;python2 </span><span class="si">{}</span><span class="s2"> --config </span><span class="si">{}</span><span class="s2"> --os unix --processors </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bacpipe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yamlconfig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor_</span> <span class="p">)</span>
		<span class="k">return</span> <span class="n">command</span></div>

<div class="viewcode-block" id="UAntwerpBacpipe.command_builder_mock"><a class="viewcode-back" href="../pipelines.html#pipelines.UAntwerpBacpipe.command_builder_mock">[docs]</a>	<span class="k">def</span> <span class="nf">command_builder_mock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		pass</span>
<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="sd">&quot;&quot;&quot; /hps/nobackup/nucleotide/blaise/selecta/development_blaise/bacpipe_mock/*  &quot;&quot;&quot;</span>
		<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;cp -r /hps/nobackup/nucleotide/blaise/selecta/development_blaise/bacpipe_mock/* </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">command</span></div>

<div class="viewcode-block" id="UAntwerpBacpipe.run"><a class="viewcode-back" href="../pipelines.html#pipelines.UAntwerpBacpipe.run">[docs]</a>	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		pass</span>
<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">processing_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">job_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsf</span><span class="p">:</span>
			<span class="n">sub_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
			<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">sub_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

			<span class="k">if</span> <span class="n">out</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;standard output of subprocess:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
					<span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
						<span class="n">message</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
					<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

			<span class="k">if</span> <span class="n">err</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;standard error of subprocess:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
					<span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
						<span class="n">message</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
					<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="c1"># Comment this out after amending A above</span>
			<span class="k">if</span> <span class="n">sub_process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">err</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
					<span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LSF option is set to true .....&quot;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
			<span class="n">job_id</span> <span class="o">=</span> <span class="n">bsub</span><span class="p">(</span><span class="s1">&#39;core_executor_&#39;</span> <span class="o">+</span> <span class="n">processing_id</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rmem</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmem</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bgroup</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span>
				<span class="n">command</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">job_id</span><span class="p">]</span></div>


<div class="viewcode-block" id="UAntwerpBacpipe.post_process"><a class="viewcode-back" href="../pipelines.html#pipelines.UAntwerpBacpipe.post_process">[docs]</a>	<span class="k">def</span> <span class="nf">post_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		pass</span>
<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">tab_result_names</span><span class="o">=</span><span class="p">[]</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Doing post process:.........&quot;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workind directory:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">))</span>
		<span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;chmod -R a+rw </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="n">sub_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
		<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">sub_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">out</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">err</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
		<span class="n">new_run_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">all_result_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_UAntwerp_Bacpipe_all&quot;</span>
		<span class="n">all_result_name_gzip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_UAntwerp_Bacpipe_all.tar.gz&quot;</span>
		<span class="n">tab_result_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_UAntwerp_Bacpipe_summary.xlsx&quot;</span>

		<span class="n">xls_basename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">xls_basename</span> <span class="o">=</span> <span class="n">xls_basename</span> <span class="o">+</span> <span class="s1">&#39;_1&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pair</span> <span class="k">else</span> <span class="n">xls_basename</span>

		<span class="n">src_tsv_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;Summary/&#39;</span> <span class="o">+</span> <span class="n">xls_basename</span> <span class="o">+</span> <span class="s1">&#39;.xlsx&#39;</span>
		<span class="n">virulencefinder_result</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;virulencefinder_output.txt&#39;</span>
		<span class="n">resfinder_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;resfinder_output.txt&#39;</span>
		<span class="n">resfams_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;resfams_output.txt&#39;</span>
		<span class="n">plasmids_finder_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;plasmids_finder_output.txt&#39;</span>
		<span class="n">mlst_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;mlst_output.txt&#39;</span>
		<span class="n">emm_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;emm_output.txt&#39;</span>
		<span class="n">cardsearch_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;cardSearch_output.txt&#39;</span>
		<span class="n">virdbsearch_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;VirDBSearch_output.txt&#39;</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xls_basename:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">xls_file:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">virulencefinder_result:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">resfinder_result:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
			  <span class="s2">&quot;resfams_result:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">plasmids_finder_result:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">mlst_result:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">emm_result:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
			  <span class="s2">&quot;cardsearch_result:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">cardsearch_result:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">virdbsearch_result:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xls_basename</span><span class="p">,</span>
																						   <span class="n">src_tsv_file</span><span class="p">,</span>
																						   <span class="n">virulencefinder_result</span><span class="p">,</span>
																						   <span class="n">resfinder_result</span><span class="p">,</span>
																						   <span class="n">resfams_result</span><span class="p">,</span>
																						   <span class="n">plasmids_finder_result</span><span class="p">,</span>
																						   <span class="n">mlst_result</span><span class="p">,</span>
																						   <span class="n">emm_result</span><span class="p">,</span>
																						   <span class="n">cardsearch_result</span><span class="p">,</span>
																						   <span class="n">cardsearch_result</span><span class="p">,</span>
																						   <span class="n">virdbsearch_result</span><span class="p">))</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>


		<span class="k">try</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">)</span>
			<span class="n">bacpipe_process_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">xls_basename</span>
			<span class="n">genome_assemblies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;genome_assemblies&#39;</span>
			<span class="n">bacpipe_summary_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;Summary&#39;</span>

			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bacpipe process_dir:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bacpipe_process_dir</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All result name:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All result name zip:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">all_result_name_gzip</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Genome assemblies folder:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">genome_assemblies</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bacpipe_summary_dir folder:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bacpipe_summary_dir</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;src_tsv_file folder:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">src_tsv_file</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;virulencefinder_result folder:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">virulencefinder_result</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;resfinder_result folder:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resfinder_result</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;resfams_result folder:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resfams_result</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plasmids_finder_result folder:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plasmids_finder_result</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mlst_result folder:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mlst_result</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;emm_result folder:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">emm_result</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cardsearch_result folder:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cardsearch_result</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;virdbsearch_result folder:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">virdbsearch_result</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tab_result_name folder:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tab_result_name</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bacpipe_process_dir</span><span class="p">):</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Copying </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bacpipe_process_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">))</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">bacpipe_process_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">genome_assemblies</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">genome_assemblies</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bacpipe_summary_dir</span><span class="p">):</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Copying </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bacpipe_summary_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">))</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">bacpipe_summary_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">src_tsv_file</span><span class="p">):</span>
				<span class="c1">#shutil.copy(source, target)</span>
				<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src_tsv_file</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">virulencefinder_result</span><span class="p">):</span>
				<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">virulencefinder_result</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">resfinder_result</span><span class="p">):</span>
				<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">resfinder_result</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">resfams_result</span><span class="p">):</span>
				<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">resfams_result</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">plasmids_finder_result</span><span class="p">):</span>
				<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">plasmids_finder_result</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mlst_result</span><span class="p">):</span>
				<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mlst_result</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">emm_result</span><span class="p">):</span>
				<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">emm_result</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cardsearch_result</span><span class="p">):</span>
				<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cardsearch_result</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">virdbsearch_result</span><span class="p">):</span>
				<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">virdbsearch_result</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">src_tsv_file</span><span class="p">):</span>
				<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src_tsv_file</span><span class="p">,</span> <span class="n">tab_result_name</span><span class="p">)</span>
				<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tab_result_name</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">make_tar_gzip</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Copying </span><span class="si">{}</span><span class="s2"> &lt;---&gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">src_tsv_file</span><span class="p">,</span> <span class="n">tab_result_name</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GZIP  </span><span class="si">{}</span><span class="s2"> in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not make tar gzip archive, or copy src tsv to tab_result_name&#39;</span><span class="p">)</span>
		<span class="k">finally</span><span class="p">:</span>
			<span class="n">tab_result_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_result_name</span><span class="p">]</span>
			<span class="n">tab_result_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">all_result_name_gzip</span><span class="p">,</span> <span class="n">tab_result_names</span></div>



<div class="viewcode-block" id="UAntwerpBacpipe.execute"><a class="viewcode-back" href="../pipelines.html#pipelines.UAntwerpBacpipe.execute">[docs]</a>	<span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		pass</span>
<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_builder</span><span class="p">()</span>
		<span class="c1">#command = self.command_builder_mock()</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Bacpipe  command:&#39;</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="n">jobids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

		<span class="sd">&quot;&quot;&quot; Making use of LSF &quot;&quot;&quot;</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Bacpipe bjobs ids:</span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobids</span><span class="p">))</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">jobids</span></div></div>



<div class="viewcode-block" id="RivmJovian"><a class="viewcode-back" href="../pipelines.html#pipelines.RivmJovian">[docs]</a><span class="k">class</span> <span class="nc">RivmJovian</span><span class="p">:</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	To document...</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fq1</span><span class="p">,</span> <span class="n">fq2</span><span class="p">,</span> <span class="n">workdir</span><span class="p">,</span>
				 <span class="n">pair</span><span class="p">,</span> <span class="n">run_accession</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">sample_accession</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		pass</span>
<span class="sd">		:param fastq1:</span>
<span class="sd">		:param fastq2:</span>
<span class="sd">		Initialize object variables</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fq1</span> <span class="o">=</span> <span class="n">fq1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fq2</span> <span class="o">=</span> <span class="n">fq2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">run_accession</span> <span class="o">=</span> <span class="n">run_accession</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">=</span> <span class="n">sample_accession</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">workdir</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pair</span> <span class="o">=</span> <span class="n">pair</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">=</span> <span class="n">prop</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lsf</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">lsf</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rivm_jovian_base</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">rivm_jovian_base</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rmem</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">rmem</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lmem</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">lmem</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bgroup</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">bgroup</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">jovian_profile</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">rivm_jovian_profile</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">jovian_location</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">rivm_jovian_base</span>
		<span class="n">error_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span> <span class="o">=</span> <span class="n">error_list</span>

<div class="viewcode-block" id="RivmJovian.copy_src_into_dest"><a class="viewcode-back" href="../pipelines.html#pipelines.RivmJovian.copy_src_into_dest">[docs]</a>	<span class="k">def</span> <span class="nf">copy_src_into_dest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		copy pipeline intermediate files into a destination directory for the</span>
<span class="sd">		purpose of archiving.</span>
<span class="sd">		:param src:  Source directory</span>
<span class="sd">		:param dest: Destination directory</span>
<span class="sd">		:return: None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
		<span class="n">dest_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Copying </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest_file</span><span class="p">))</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest_file</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">shutil</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
			<span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Directory not copied. Error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
			<span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Directory not copied. Error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="RivmJovian.jovian_init"><a class="viewcode-back" href="../pipelines.html#pipelines.RivmJovian.jovian_init">[docs]</a>	<span class="k">def</span> <span class="nf">jovian_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		:return: a directory with:</span>
<span class="sd">		1 - bin folder copied therein</span>
<span class="sd">		2- A simling to profile, envs, snakefile</span>
<span class="sd">		3- Creation of fastq directory where fastqs file are moved</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">copy_profile</span><span class="o">=</span> <span class="s2">&quot;cp -rv </span><span class="si">{}</span><span class="s2">/profile </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jovian_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">copy_jovian</span> <span class="o">=</span> <span class="s2">&quot;cp -v </span><span class="si">{}</span><span class="s2">/jovian </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jovian_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">copy_envs</span> <span class="o">=</span> <span class="s2">&quot;cp -rv </span><span class="si">{}</span><span class="s2">/envs </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jovian_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">copy_snakefile</span> <span class="o">=</span> <span class="s2">&quot;cp -v </span><span class="si">{}</span><span class="s2">/Snakefile </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jovian_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">copy_files</span> <span class="o">=</span> <span class="s2">&quot;cp -rv </span><span class="si">{}</span><span class="s2">/files </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jovian_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">copy_bin</span> <span class="o">=</span> <span class="s2">&quot;cp -rv </span><span class="si">{}</span><span class="s2">/bin </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jovian_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">copy_call</span> <span class="o">=</span> <span class="s2">&quot;cp -v </span><span class="si">{}</span><span class="s2">/jovian_bash.sh </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jovian_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">copy_git</span> <span class="o">=</span> <span class="s2">&quot;cp -rv </span><span class="si">{}</span><span class="s2">/.git </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jovian_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">copy_rules</span> <span class="o">=</span> <span class="s2">&quot;cp -rv </span><span class="si">{}</span><span class="s2">/rules </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jovian_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">command</span> <span class="o">=</span> <span class="n">copy_profile</span> <span class="o">+</span> <span class="s2">&quot; &amp;&amp; &quot;</span> <span class="o">+</span> \
		          <span class="n">copy_jovian</span> <span class="o">+</span> <span class="s2">&quot; &amp;&amp; &quot;</span> <span class="o">+</span> \
		          <span class="n">copy_envs</span> <span class="o">+</span> <span class="s2">&quot; &amp;&amp; &quot;</span> <span class="o">+</span> \
		          <span class="n">copy_snakefile</span> <span class="o">+</span> <span class="s2">&quot; &amp;&amp; &quot;</span> <span class="o">+</span> \
		          <span class="n">copy_files</span> <span class="o">+</span> <span class="s2">&quot; &amp;&amp; &quot;</span> <span class="o">+</span> \
		          <span class="n">copy_bin</span> <span class="o">+</span> <span class="s2">&quot; &amp;&amp; &quot;</span> <span class="o">+</span> \
		          <span class="n">copy_call</span> <span class="o">+</span> <span class="s2">&quot; &amp;&amp; &quot;</span> <span class="o">+</span> \
		          <span class="n">copy_git</span> <span class="o">+</span> <span class="s2">&quot; &amp;&amp; &quot;</span> <span class="o">+</span> \
				  <span class="n">copy_rules</span>
		<span class="n">fastq_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s2">&quot;fastqs&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fastq_dir</span><span class="p">):</span>
			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">fastq_dir</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fq1</span><span class="p">):</span>
			<span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fq1</span><span class="p">,</span> <span class="n">fastq_dir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fq1</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fq2</span><span class="p">):</span>
			<span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fq2</span><span class="p">,</span> <span class="n">fastq_dir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fq2</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">sub_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
			<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">sub_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span></div>

<div class="viewcode-block" id="RivmJovian.command_builder"><a class="viewcode-back" href="../pipelines.html#pipelines.RivmJovian.command_builder">[docs]</a>	<span class="k">def</span> <span class="nf">command_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		pass</span>
<span class="sd">		:return:</span>
<span class="sd">		change into process_id dir prior jovian run</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;cd </span><span class="si">{}</span><span class="s2"> &amp;&amp; ./jovian_bash.sh &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">command</span></div>

<div class="viewcode-block" id="RivmJovian.command_builder_mock"><a class="viewcode-back" href="../pipelines.html#pipelines.RivmJovian.command_builder_mock">[docs]</a>	<span class="k">def</span> <span class="nf">command_builder_mock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		pass</span>
<span class="sd">		:return:</span>
<span class="sd">		Below hard coded path should be removed</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">copy_result</span> <span class="o">=</span> <span class="s2">&quot;cp -rv /hps/nobackup/nucleotide/blaise/selecta/tools/jovian/mock_run/</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span> <span class="c1"># ,&#39;data&#39;,&#39;logs&#39;,&#39;files&#39;,</span>
		<span class="n">copy_data</span> <span class="o">=</span> <span class="s2">&quot;cp -rv /hps/nobackup/nucleotide/blaise/selecta/tools/jovian/mock_run/</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">copy_logs</span> <span class="o">=</span> <span class="s2">&quot;cp -rv /hps/nobackup/nucleotide/blaise/selecta/tools/jovian/mock_run/</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">command</span> <span class="o">=</span> <span class="n">copy_result</span> <span class="o">+</span> <span class="s2">&quot; &amp;&amp; &quot;</span> <span class="o">+</span> <span class="n">copy_data</span> <span class="o">+</span> <span class="s2">&quot; &amp;&amp; &quot;</span> <span class="o">+</span> <span class="n">copy_logs</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="n">copy_profile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/profile&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">link_jovian</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/jovian&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">link_envs</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/envs&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">link_snakefile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/Snakefile&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">link_files</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/files&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">copy_bin</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/bin&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">copy_call</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/jovian_bash.sh&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="n">link_git</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/.git&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">copy_profile</span><span class="p">)</span>  <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">link_jovian</span><span class="p">)</span>  \
		        <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">link_envs</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">link_snakefile</span><span class="p">)</span> \
		        <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">link_files</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">copy_bin</span><span class="p">)</span> \
				<span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">copy_call</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">link_git</span><span class="p">))</span> <span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">jovian_init</span><span class="p">()</span>

		<span class="k">return</span> <span class="n">command</span></div>


<div class="viewcode-block" id="RivmJovian.post_process"><a class="viewcode-back" href="../pipelines.html#pipelines.RivmJovian.post_process">[docs]</a>	<span class="k">def</span> <span class="nf">post_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing in </span><span class="si">{}</span><span class="s2">:.........&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">))</span>
		<span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;chmod -R a+rw </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="n">sub_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
		<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">sub_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">out</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">err</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>

		<span class="c1">#DtuCge.delete_empty_files(self.workdir)</span>
		<span class="sd">&quot;&quot;&quot; Might uncomment the above subsequently&quot;&quot;&quot;</span>
		<span class="c1"># use process_id (new_run_process ) instead of run_id (self.run_accession) to account for problematic duplicate RUNS ids from different datahub</span>
		<span class="n">new_run_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">all_result_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_Rivm_Jovian_all&quot;</span>
		<span class="n">DtuCge</span><span class="o">.</span><span class="n">del_file</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">all_result_name_gzip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_Rivm_Jovian_all.tar.gz&quot;</span>
		<span class="n">DtuCge</span><span class="o">.</span><span class="n">del_file</span><span class="p">(</span><span class="n">all_result_name_gzip</span><span class="p">)</span>
		<span class="sd">&quot;&quot;&quot; Summary files</span>
<span class="sd">		all_virusHost.tsv</span>
<span class="sd">		all_taxClassified.tsv</span>
<span class="sd">		all_taxUnclassified.tsv</span>
<span class="sd">		all_filtered_SNPs.tsv</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">tab_result_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_Rivm_Jovian_virusHost.tsv&quot;</span>
		<span class="n">tab_result_name2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_Rivm_Jovian_taxClassified.tsv&quot;</span>
		<span class="n">tab_result_name3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_Rivm_Jovian_taxUnclassified.tsv&quot;</span>
		<span class="n">tab_result_name4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="n">new_run_process</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span> <span class="o">+</span> <span class="s2">&quot;_analysis_Rivm_Jovian_filteredSNPs.tsv&quot;</span>
		<span class="n">DtuCge</span><span class="o">.</span><span class="n">del_file</span><span class="p">(</span><span class="n">tab_result_name</span><span class="p">)</span>
		<span class="n">DtuCge</span><span class="o">.</span><span class="n">del_file</span><span class="p">(</span><span class="n">tab_result_name2</span><span class="p">)</span>
		<span class="n">DtuCge</span><span class="o">.</span><span class="n">del_file</span><span class="p">(</span><span class="n">tab_result_name3</span><span class="p">)</span>
		<span class="n">DtuCge</span><span class="o">.</span><span class="n">del_file</span><span class="p">(</span><span class="n">tab_result_name4</span><span class="p">)</span>

		<span class="n">all_virusHost</span><span class="p">,</span><span class="n">all_taxClassified</span><span class="p">,</span><span class="n">all_taxUnclassified</span><span class="p">,</span><span class="n">all_filtered_SNPs</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;results/all_virusHost.tsv&#39;</span><span class="p">):</span>
			<span class="n">all_virusHost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;results/all_virusHost.tsv&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;results/all_taxClassified.tsv&#39;</span><span class="p">):</span>
			<span class="n">all_taxClassified</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;results/all_taxClassified.tsv&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;results/all_taxUnclassified.tsv&#39;</span><span class="p">):</span>
			<span class="n">all_taxUnclassified</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;results/all_taxUnclassified.tsv&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;results/all_filtered_SNPs.tsv&#39;</span><span class="p">):</span>
			<span class="n">all_filtered_SNPs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;results/all_filtered_SNPs.tsv&#39;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">):</span>
			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">results_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;results&#39;</span>

		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">results_dir</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">data_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;data&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_dir</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>
		<span class="n">logs_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="s1">&#39;logs&#39;</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">logs_dir</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">copy_src_into_dest</span><span class="p">(</span><span class="n">logs_dir</span><span class="p">,</span> <span class="n">all_result_name</span><span class="p">)</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="sd">&quot;&quot;&quot;Archive Jovian analysis&quot;&quot;&quot;</span>
			<span class="n">DtuCge</span><span class="o">.</span><span class="n">make_tar_gzip</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">all_virusHost</span><span class="p">):</span>
				<span class="n">copyfile</span><span class="p">(</span><span class="n">all_virusHost</span><span class="p">,</span> <span class="n">tab_result_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">all_taxClassified</span><span class="p">):</span>
				<span class="n">copyfile</span><span class="p">(</span><span class="n">all_taxClassified</span><span class="p">,</span> <span class="n">tab_result_name2</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">all_taxUnclassified</span><span class="p">):</span>
				<span class="n">copyfile</span><span class="p">(</span><span class="n">all_taxUnclassified</span><span class="p">,</span> <span class="n">tab_result_name3</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">all_filtered_SNPs</span><span class="p">):</span>
				<span class="n">copyfile</span><span class="p">(</span><span class="n">all_filtered_SNPs</span><span class="p">,</span> <span class="n">tab_result_name4</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not make tar gzip archive, or copy src tsv to tab_result_name&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Post-process finished for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">all_result_name</span><span class="p">))</span>
		<span class="n">tab_result_names</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tab_result_name</span><span class="p">):</span>
			<span class="n">tab_result_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tab_result_name</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tab_result_name2</span><span class="p">):</span>
			<span class="n">tab_result_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tab_result_name2</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tab_result_name3</span><span class="p">):</span>
			<span class="n">tab_result_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tab_result_name3</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tab_result_name4</span><span class="p">):</span>
			<span class="n">tab_result_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tab_result_name4</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">tab_result_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">all_result_name_gzip</span><span class="p">,</span> <span class="n">tab_result_names</span></div>

<div class="viewcode-block" id="RivmJovian.run"><a class="viewcode-back" href="../pipelines.html#pipelines.RivmJovian.run">[docs]</a>	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		pass</span>
<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">processing_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">job_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsf</span><span class="p">:</span>
			<span class="n">sub_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
			<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">sub_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

			<span class="k">if</span> <span class="n">out</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;standard output of subprocess:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
					<span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
						<span class="n">message</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
					<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

			<span class="k">if</span> <span class="n">err</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;standard error of subprocess:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
				<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
					<span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
						<span class="n">message</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
					<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="c1"># Comment this out after amending A above</span>
			<span class="k">if</span> <span class="n">sub_process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">err</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
					<span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LSF option is set to true .....&quot;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
			<span class="n">job_id</span> <span class="o">=</span> <span class="n">bsub</span><span class="p">(</span><span class="s1">&#39;core_executor_&#39;</span> <span class="o">+</span> <span class="n">processing_id</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rmem</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmem</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bgroup</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span>
				<span class="n">command</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">job_id</span><span class="p">]</span></div>


<div class="viewcode-block" id="RivmJovian.execute"><a class="viewcode-back" href="../pipelines.html#pipelines.RivmJovian.execute">[docs]</a>	<span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		pass</span>
<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_builder</span><span class="p">()</span>
		<span class="c1">#command = self.command_builder_mock()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">jovian_init</span><span class="p">()</span>


		<span class="sd">&quot;&quot;&quot; Make sure we are in the processing directory b4 jovian run &quot;&quot;&quot;</span>
		<span class="n">jobids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Jovian bjobs ids:</span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobids</span><span class="p">))</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Jovian  command:&#39;</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">jobids</span></div></div>


<div class="viewcode-block" id="FliRiems"><a class="viewcode-back" href="../pipelines.html#pipelines.FliRiems">[docs]</a><span class="k">class</span> <span class="nc">FliRiems</span><span class="p">:</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	To document ...</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fastq1</span><span class="p">,</span> <span class="n">fastq2</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Pass</span>
<span class="sd">		:param fastq1:</span>
<span class="sd">		:param fastq2:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fastq1</span> <span class="o">=</span> <span class="n">fastq1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fastq2</span> <span class="o">=</span> <span class="n">fastq2</span>


<div class="viewcode-block" id="FliRiems.command_builder"><a class="viewcode-back" href="../pipelines.html#pipelines.FliRiems.command_builder">[docs]</a>	<span class="k">def</span> <span class="nf">command_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Pass</span>
<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">pass</span></div>

<div class="viewcode-block" id="FliRiems.command_builder_mock"><a class="viewcode-back" href="../pipelines.html#pipelines.FliRiems.command_builder_mock">[docs]</a>	<span class="k">def</span> <span class="nf">command_builder_mock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Pass</span>
<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">pass</span></div>

	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Pass</span>
<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">pass</span>

<div class="viewcode-block" id="FliRiems.post_process"><a class="viewcode-back" href="../pipelines.html#pipelines.FliRiems.post_process">[docs]</a>	<span class="k">def</span> <span class="nf">post_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Pass</span>
<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">pass</span></div>

<div class="viewcode-block" id="FliRiems.run"><a class="viewcode-back" href="../pipelines.html#pipelines.FliRiems.run">[docs]</a>	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Pass</span>
<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">pass</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Blaise T.F. Alako

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>